<html>
<body>
<audio loop id="player" src="loudpipes.mp3" autoplay="" controls="" style="display:none;"></audio>
<canvas id="canvas" height="600" width="1024" ></canvas>

<script>

function $id(obj) {
	return document.getElementById(obj);
}

var canvas = $id("canvas");
var ctx = canvas.getContext("2d");


window.AudioContext = window.AudioContext || window.webkitAudioContext || window.mozAudioContext;


    window.player = document.getElementById('player');
    context = new AudioContext();
    source = context.createMediaElementSource(player);
    analyser = context.createAnalyser();
    source.connect(analyser);
    analyser.connect(context.destination);

 	var frequencyData = new Uint8Array(analyser.frequencyBinCount);
 

 	ctx.strokeStyle="#ff0000";
 	ctx.lineWidth="1";

  function renderFrame() {
  	ctx.clearRect(0,0,1024,600);
    analyser.getByteFrequencyData(frequencyData);

    //var data = "";

    var sum=0, sum2=0;

	var n = 300;
	var n2= frequencyData.length - n;
    document.title = frequencyData.length;
    for(var i =0 ;i<frequencyData.length;i++) {
    	ctx.beginPath();

    	ctx.moveTo(i,600);
    	ctx.lineTo(i,600 - frequencyData[i]);
    	ctx.stroke();
    	ctx.closePath();



	}

}

setInterval(renderFrame,30);
</script>
</body>
</html>